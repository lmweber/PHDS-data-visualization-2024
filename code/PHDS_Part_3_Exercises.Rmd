---
title: "PHDS Data Visualization Workshop: Exercise Session"
author: "Prasad Patil and Lukas M. Weber"
date: "2024-03-22"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Introduction

For the exercise session, we will use the `UFO Sightings` dataset available from the [TidyTuesday](https://github.com/rfordatascience/tidytuesday) project.

A link to the UFO Sightings dataset is available here: https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-06-20/readme.md

The link above includes background about the dataset, a summary of the data variables that are provided, and additional instructions on how to download the data.


# Download data

Below, we provide some code to download and preprocess the dataset, and save it as a new .csv file.

Specifically, we will add the `latitude` and `longitude` columns from `places.csv` to the main data frame in `ufo_sightings.csv`. For more details, see the information about the data frame at the link above.

```{r, message=FALSE}
library(tidyverse)
library(here)
library(tidytuesdayR)
```

Download the dataset from the `tidytuesdayR` package:

```{r}
# download dataset from tidytuesdayR package
tuesdata <- tt_load("2023-06-20")

# check
tuesdata
```

Extract the data:

```{r}
# extract data
ufo_sightings <- tuesdata$ufo_sightings
places <- tuesdata$places
day_parts_map <- tuesdata$day_parts_map
```

Alternatively, the data objects can also be downloaded and read in from links to the .csv files:

```{r}
# alternatively, download and read in from links to .csv files
# ufo_sightings <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-06-20/ufo_sightings.csv")
# places <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-06-20/places.csv")
# day_parts_map <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-06-20/day_parts_map.csv")
```

Have a look at the data:

```{r}
ufo_sightings
places
day_parts_map

dim(ufo_sightings)
dim(places)
dim(day_parts_map)
```


# Preprocessing

Add the columns `latitude` and `longitude` to the main data frame `ufo_sightings`.

Note that this dataset is somewhat messy. There are some duplicated entries in `places`, which we need to remove before we join the data frames. The duplicated rows can be identified by combining the `city`, `state`, and `country_code` columns.

```{r}
# remove duplicated entries in 'places'
dups <- duplicated(paste0(places$city, places$state, places$country_code))
table(dups)

places <- places[!dups, ]

dim(places)
```

```{r}
# join data frames
ufo_sightings_latlong <- ufo_sightings |> 
  left_join(select(places, "city", "state", "country_code", "latitude", "longitude"), 
            by = join_by(city == city, state == state, country_code == country_code))

dim(ufo_sightings_latlong)
```


# Save data

```{r}
# save data
write_csv(ufo_sightings_latlong, file = here("data/ufo_sightings_latlong.csv"))
```
